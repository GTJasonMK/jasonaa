# 10-场景系统

> **文档版本**: v1.0
> **最后更新**: 2025-10-31
> **负责人**: 待定
> **优先级**: ⭐⭐⭐⭐⭐ (核心基础)
> **实现版本**: MVP v1.0

---

## 📋 相关文档

**前置依赖**: 无（这是最基础的系统）

**相关文档**:
- [11-桌宠AI与需求系统](./11-桌宠AI与需求系统.md) - AI需要知道场景位置
- [14-供奉系统](./14-供奉系统.md) - 依赖祭坛场景
- [15-任务系统](./15-任务系统.md) - 依赖工作台场景
- [37-新场景扩展](../30-扩展系统/37-新场景扩展.md) - 后期扩展

---

## 一、系统概述

### 1.1 设计理念

场景系统是游戏的**物理世界基础**，定义了桌宠生活的空间和可进行的活动。

**核心原则**:
1. **功能明确**: 每个场景有清晰的主要功能
2. **生态关联**: 场景之间不是孤立的，有有机联系
3. **视觉区分**: 每个场景有独特的视觉风格和氛围
4. **可扩展性**: 场景可以升级和扩展

### 1.2 五大核心场景

**游戏世界布局（俯视图）**:

场景分布:
- 上方: 池塘和田地横向相连
- 中央: 家作为核心枢纽
- 下方: 祭坛位于左侧,工作台位于右侧

**连接关系**:
- 池塘 ↔ 田地: 取水浇地
- 田地 ↔ 家: 存储收获
- 家 ↔ 祭坛: 准备供奉
- 家 ↔ 工作台: 任务执行
- 祭坛 ↔ 池塘: 净身仪式

---

## 二、田地系统 (Farm)

### 2.1 场景概述

**主要功能**: 种植作物、收获果实、农业生产

**氛围**: 生机勃勃、辛勤劳作、丰收喜悦

**视觉元素**:
- 土地格子（3-10块可扩展）
- 作物生长动画
- 农具摆放（锄头、水桶、肥料袋）
- 稻草人（装饰/功能）
- 小径和围栏

### 2.2 土地格子系统

#### 2.2.1 基础配置

**初始配置**:
- 土地数量: 3块
- 可扩展至: 10块
- 扩展条件: 消耗200神力点数/块
- 布局: 3×N网格排列

**每块土地属性**:
- 尺寸: 64×64像素
- 状态: 干旱/湿润/肥沃/贫瘠
- 作物: 空/种子/幼苗/成长/成熟
- 生长进度: 0-100%

#### 2.2.2 土地状态系统

**状态1: 干旱 (Dry)**
- 视觉: 土地龟裂纹理、暗褐色
- 影响: 作物生长速度降低50%
- 触发: 3游戏小时无浇水
- 恢复: 浇水或下雨

**状态2: 湿润 (Moist)**
- 视觉: 深褐色、有水光
- 影响: 正常生长速度
- 触发: 浇水后或雨天
- 持续: 6游戏小时

**状态3: 肥沃 (Fertile)**
- 视觉: 深黑色、有光泽、小草发芽
- 影响: 作物生长速度提升20%、产量提升10%
- 触发: 使用肥料
- 持续: 一个作物周期

**状态4: 贫瘠 (Barren)**
- 视觉: 浅灰色、坚硬
- 影响: 无法种植,需要恢复
- 触发: 连续种植5次未施肥
- 恢复: 使用肥料或休耕1周期

#### 2.2.3 土地交互点

**设计说明**:
每块土地包含多个交互点:
- 种植点(中心位置)
- 浇水点(四周4个位置)
- 施肥点(边缘位置)
- 收获点(作物上方)

每个交互点具有坐标、状态、作物信息和生长进度等属性。

*(具体数据结构详见50-技术实现目录)*

### 2.3 作物系统

#### 2.3.1 作物生长阶段

**阶段划分（5个阶段）**:

**1. 种子期 (0-10%)**:
- 视觉: 土堆微微隆起
- 时长: 10%周期

**2. 发芽期 (10-30%)**:
- 视觉: 小芽破土而出
- 时长: 20%周期

**3. 生长期 (30-70%)**:
- 视觉: 茎叶快速生长
- 时长: 40%周期
- 最需要水分

**4. 成熟期 (70-100%)**:
- 视觉: 果实出现并长大
- 时长: 30%周期

**5. 可收获 (100%)**:
- 视觉: 饱满果实、闪光提示
- 持续: 无限期（不会腐烂）
- 过熟: 100%后2天开始品质下降

#### 2.3.2 作物数据表

**快速作物** (适合新手):
| 作物 | 周期 | 需水量 | 产量 | 季节 | 特殊 |
|------|------|--------|------|------|------|
| 萝卜 | 2天 | 2次/天 | 1-2 | 全季 | 最基础 |
| 白菜 | 3天 | 2次/天 | 2-3 | 春秋 | 耐寒 |

**中速作物** (平衡):
| 作物 | 周期 | 需水量 | 产量 | 季节 | 特殊 |
|------|------|--------|------|------|------|
| 小麦 | 5天 | 1次/天 | 3-5 | 春夏 | 耐旱 |
| 玉米 | 7天 | 3次/天 | 2-4 | 夏季 | 高产 |

**慢速作物** (高价值):
| 作物 | 周期 | 需水量 | 产量 | 季节 | 特殊 |
|------|------|--------|------|------|------|
| 南瓜 | 10天 | 2次/天 | 1大个 | 秋季 | 高价值 |
| 特殊作物 | 15天 | 精心照料 | 1 | 特定条件 | 稀有 |

#### 2.3.3 作物生长算法

**算法设计**:
作物生长受多种因素影响:
- 基础生长速度(不同作物有不同基准值)
- 土壤状态修正系数(0.5-1.2)
- 水分修正系数(0.5-1.0)
- 季节修正系数(0.8-1.2)
- 天气修正系数(0.9-1.2)

最终生长速度 = 基础速度 × 各修正系数乘积

水分管理:
- 水分每小时自然衰减20点
- 水分<30时影响作物健康
- 生长进度达100%时可收获

*(具体实现详见50-技术实现目录)*

### 2.4 农业行为

#### 2.4.1 种植行为

**行为流程**:
1. 桌宠选择种子（从仓库）
2. 走到空土地前
3. 动画: 弯腰 → 挖坑 → 放种子 → 填土 → 拍实
4. 播放音效: 挖土声 + 拍土声
5. 种子消失,土地显示"种子期"
6. 桌宠站起,满意地擦汗

**消耗数据**:
- 时间消耗: 约10秒（游戏内10分钟）
- 体力消耗: 减少5点
- 心情变化: 增加2点（喜欢种植的桌宠）

#### 2.4.2 浇水行为

**行为流程**:
1. 桌宠判断哪些土地需要浇水
2. 前往池塘取水（提着水桶）
3. 走到干旱土地前
4. 动画: 举起水桶 → 倾倒 → 水流动画 → 土地变湿润
5. 播放音效: 水流声 + 土壤吸水声
6. 重复直到所有土地浇完或水桶空

**效率数据**:
- 优化: 一次取水可以浇3块地
- 时间消耗: 取水30秒 + 每块地10秒
- 体力消耗: 每块地减少3点

#### 2.4.3 收获行为

**行为流程**:
1. 桌宠看到成熟作物（闪光提示）
2. 走到作物前
3. 动画（根据作物类型）:
   - 萝卜/白菜: 弯腰 → 拔出 → 抖掉泥土
   - 小麦: 挥镰刀 → 捆扎 → 扛起
   - 玉米: 掰下 → 放入篮子
   - 南瓜: 用力拔 → 滚到一边 → 搬起
4. 播放音效: 丰收的清脆声音 + 欢快音乐
5. 作物进入仓库,土地恢复空
6. 桌宠表情: 开心 → 可能展示收获物

**特殊情况**:
- 完美品质: 额外动画（惊喜表情、举高炫耀）
- 首次收获新作物: 特殊庆祝动画

### 2.5 场景升级与扩展

#### 2.5.1 土地扩展

**扩展路径**:
- 3块（初始）→ 5块（200神力）→ 7块（400神力）→ 10块（600神力）

**扩展动画**:
1. 桌宠祈祷
2. 神力光柱降临
3. 新土地从地面升起
4. 围栏自动延伸
5. 桌宠欢呼庆祝

#### 2.5.2 温室系统 (MVP v2.5+)

**解锁条件**:
- 收获500个作物
- 消耗1000神力点数 + 500金币

**功能**:
- 冬季也能种植
- 生长速度提升15%
- 不受天气影响
- 可以种植特殊作物

**视觉**:
- 玻璃温室罩在田地上方
- 内部温暖光效
- 自动洒水系统

#### 2.5.3 自动化设施

**自动洒水系统**:
- 解锁: 农业技能Lv7
- 效果: 每天自动浇水一次
- 视觉: 喷头装置,定时喷水动画

**稻草人**:
- 功能: 防止鸟类偷食（减少产量损失）
- 效果: 产量保护率提升10%
- 视觉: 可爱的稻草人,风吹时摇晃

---

## 三、池塘系统 (Pond)

### 3.1 场景概述

**主要功能**: 钓鱼、取水、休闲观赏

**氛围**: 宁静、清澈、生机盎然

**视觉元素**:
- 水体（中心深，边缘浅）
- 荷叶、芦苇
- 鱼类游动（可见）
- 水草摇曳
- 石头和小桥
- 钓鱼点标记

### 3.2 水质系统

#### 3.2.1 水质状态

**清澈 (Clear)**:

*视觉效果*:
- 透明度高,能看到水底
- 波光粼粼效果
- 鱼类清晰可见

*游戏影响*:
- 钓鱼效率: 100%
- 稀有鱼概率: 基础值
- 桌宠心情: 在此休息每小时增加5点

*触发条件*: 初始状态,或雨后,或定期清理

**浑浊 (Murky)**:

*视觉效果*:
- 透明度降低50%
- 水色发黄
- 鱼类模糊

*游戏影响*:
- 钓鱼效率: 降低20%
- 稀有鱼概率: 降低10%
- 桌宠心情: 无影响

*触发条件*: 连续7天无雨
*持续时间*: 直到下雨或清理

**污染 (Polluted)**:

*视觉效果*:
- 水面垃圾（树叶、杂物）
- 水色发绿（藻类）
- 鱼类不可见

*游戏影响*:
- 无法钓鱼
- 无法取水浇地
- 桌宠心情: 每小时下降5点

*触发条件*: 连续14天无清理
*恢复方式*: 需要执行"清理池塘"任务

#### 3.2.2 水质管理

**水质变化规则**:
- 水质值范围:0-100
- 污染值范围:0-100
- 每天自然衰减2点水质
- 每天累积0.5点污染
- 下雨时水质恢复(每小时+10),污染降低(每小时-5)

**水质状态判定**:
- 水质>70: 清澈
- 水质30-70: 浑浊
- 水质<30: 污染

*(具体实现详见50-技术实现目录)*

### 3.3 钓鱼系统

#### 3.3.1 钓鱼点位

**池塘区域划分**:

**浅水区（边缘）**:
- 普通鱼概率: 90%
- 稀有鱼概率: 10%
- 传说鱼概率: 0%

**深水区（中心）**:
- 普通鱼概率: 60%
- 稀有鱼概率: 35%
- 传说鱼概率: 5%

**特殊点位（荷叶下、石头边）**:
- 普通鱼概率: 40%
- 稀有鱼概率: 50%
- 传说鱼概率: 10%

#### 3.3.2 鱼类栖息系统

**鱼群动态机制**:
- 初始鱼群:普通鱼20条,稀有鱼5条,传说鱼1条
- 水质>50时鱼群自然繁殖(每天+2普通鱼)
- 普通鱼<10时触发休渔警告
- 彩虹天气时可能刷新传说鱼

**钓鱼概率计算**:
钓鱼成功率 = 基础概率 × (1 + 技能加成 + 天气加成) × 水质加成
- 技能加成:每级+2%
- 天气加成:雨天+20%
- 水质加成:水质值/100

*(具体实现详见50-技术实现目录)*

#### 3.3.3 钓鱼行为流程

**完整钓鱼流程**:

**1. 选择钓点**
- 桌宠走到池塘边
- AI选择最佳钓点（根据技能和经验）

**2. 准备**
- 拿出鱼竿
- 挂饵（如果有）
- 调整姿势

**3. 甩竿**
- 动画: 举竿 → 后摆 → 前甩 → 鱼线飞出
- 音效: 嗖~啪叽（入水声）
- 浮标漂浮

**4. 等待**
- 浮标在水面晃动
- 桌宠耐心等待（表情变化）
- 时间: 10-60秒（游戏内）
- 可能: 无鱼、跑鱼、咬钩

**5. 咬钩**
- 浮标剧烈下沉
- 音效: 咬钩提示音
- 桌宠反应: 警觉表情

**6. 拉竿（QTE简化版）**
- 桌宠自动判断时机
- 成功率 = 技能等级 × 随机因素
- 动画: 用力拉竿 → 收线 → 鱼出水

**7. 结果**

*成功*:
- 鱼飞出水面（抛物线动画）
- 桌宠开心接住
- 展示战利品
- 放入篮子
- 心情增加10点,经验增加

*失败*:
- 鱼挣脱,水花四溅
- 桌宠失望表情
- 对话: "可惜...差一点就抓到了"
- 心情减少5点

**8. 休息或继续**
- 评估体力和心情
- 决定是否继续钓鱼

### 3.4 取水功能

**取水流程（用于浇地）**:

1. 桌宠拿着空水桶
2. 走到水边
3. 蹲下,水桶伸入水中
4. 水流动画,水桶变满
5. 提起水桶（重量感动画）
6. 返回田地

**效率数据**:
- 一次取水可浇3块地
- 消耗时间: 30秒（游戏内30分钟）
- 体力消耗: 减少2点

**特殊情况**:
- 污染水质无法取水
- 冬季结冰需要破冰

### 3.5 休闲观赏

**休闲行为**:

**坐在池塘边**:
- 桌宠坐在石头/小桥上
- 双脚垂在水面
- 观看鱼类游动
- 效果: 快乐度每10分钟增加5点,疲劳度每10分钟恢复3点
- 对话: "这里真安静...""看,那条鱼好大!"

**喂鱼**:
- 拿出面包屑
- 撒入水中
- 鱼群聚集（可爱动画）
- 桌宠开心
- 效果: 快乐度增加10点,鱼群繁殖速度提升10%

**荷叶跳跳**:
- 趣味互动
- 桌宠在荷叶间跳跃
- Q版动画,充满童趣
- 效果: 快乐度增加15点,消耗体力5点

---

## 四、家系统 (Home)

### 4.1 场景概述

**主要功能**: 休息、存储、烹饪、制作、生活

**氛围**: 温馨、舒适、安全

**视觉元素**:
- 木质结构，温暖色调
- 家具齐全
- 窗户透出温暖灯光
- 门口有小花园

### 4.2 空间分区设计

**家内部布局（俯视图）**:

房屋分为五个功能区:
- **左上区**: 卧室区（床、衣柜）
- **右上区**: 烹饪区（炉灶、料理台）
- **左下区**: 仓库区（架子、箱子）
- **右下区**: 制作区（工作台、工具）
- **中央区**: 起居区（桌子、椅子）
- **底部**: 出入口

### 4.3 卧室区

**家具**: 床、床头柜、衣柜、窗户

**功能**:

**睡眠系统**:
**触发条件**:
- 疲劳度 < 20（强制）
- 夜晚22:00-5:00（倾向）
- 手动选择（可选）

**睡眠过程**:
1. 桌宠走到床边
2. 脱鞋动画
3. 躺下,盖被子
4. 闭眼,ZZZ泡泡浮现
5. 呼吸起伏动画
6. 可能做梦（梦境系统）

**恢复效果**:
- 疲劳度: 每小时恢复15点
- 健康度: 每小时恢复5点（如果低于100）
- 状态: 睡眠中不会饥饿

**起床**:
- 疲劳度超过80时自动醒来
- 或早晨5:00-7:00自然醒
- 伸懒腰动画
- 对话: "睡得真舒服~"

**舒适度系统**:
**影响休息效率**:

**床铺等级**:
- 基础床: 恢复速度 ×1.0
- 舒适的床: 恢复速度 ×1.3（需要升级）
- 豪华床: 恢复速度 ×1.5（需要解锁）

**舒适度加成**:
- 窗帘: +5%
- 地毯: +5%
- 装饰画: +5%
- 温暖灯光: +10%

**最高效率**: ×1.8倍恢复速度

### 4.4 仓库区

**家具**: 储物架、箱子、展示柜

**仓库系统设计**:
- 初始容量:50格
- 物品分类:作物、鱼类、烹饪食物、材料、工具、特殊物品
- 支持物品堆叠(可堆叠物品自动合并)
- 容量满时拒绝添加新物品
- 可通过升级扩容:Lv1(50)→Lv2(100)→Lv3(150)→Lv4(200)

*(具体实现详见50-技术实现目录)*

**物品展示**:
**视觉化展示**:
- 储物架上显示物品图标
- 稀有物品有光效
- 传说物品特殊展示（玻璃柜）
- 数量多时堆叠显示

**交互功能**:
- 点击查看详情
- 快速分类筛选
- 拖拽整理

### 4.5 烹饪区

**家具**: 炉灶、料理台、调料架、冰箱

**烹饪系统**:

**烹饪流程**:

**1. 选择配方**
- 桌宠打开配方书
- 根据已有食材选择
- 或尝试新组合

**2. 准备食材**
- 从仓库取出原料
- 放在料理台上
- 清洗、切割

**3. 烹饪过程**

*动画（根据菜品）*:
- 炒菜: 火焰升腾,颠勺动作
- 煮汤: 锅中冒热气,搅拌
- 烘焙: 放入烤箱,等待

**4. 完成**
- 成品出锅
- 香气特效（飘出爱心/星星）
- 桌宠品尝表情
- 效果评级: 普通/美味/完美

**消耗数据**:
- 时间消耗: 5-15分钟（游戏内）
- 失败可能: 5-20%（根据烹饪技能）

**配方系统**:
**基础配方（已知）**:
- 烤鱼: 鲫鱼 → 饱食度+40, 快乐+5
- 蔬菜沙拉: 白菜+萝卜 → 饱食度+50, 健康+10
- 玉米汤: 玉米+水 → 饱食度+45, 温暖buff

**进阶配方（需学习）**:
- 鱼汤: 鲫鱼+小麦 → 饱食度+70, 体力恢复+20%
- 丰盛大餐: 南瓜+玉米+鱼 → 饱食度+120, 全属性+10

**隐藏配方（实验发现）**:
- 彩虹料理: ??? → 神秘效果

### 4.6 制作区

**家具**: 工作台、工具架、材料箱

**制作系统**:

**可制作物品分类**:

**【工具类】**

| 物品 | 材料需求 | 制作效果 |
|------|----------|----------|
| 高级鱼竿 | 木材×5 | 钓鱼效率+20% |
| 精制锄头 | 木材×3, 铁矿×2 | 种植速度+15% |
| 便携水桶 | 木材×2 | 可多装1份水 |

**【家具类】**

| 物品 | 材料需求 | 制作效果 |
|------|----------|----------|
| 舒适的床 | 木材×10, 布料×5 | 休息效率+30% |
| 装饰画 | 布料×2 | 快乐度+5 |
| 花盆 | 陶土×3 | 美化家园 |

**【消耗品类】**

| 物品 | 材料需求 | 制作效果 |
|------|----------|----------|
| 肥料 | 有机物×5 | 土地肥沃 |
| 鱼饵 | 面包×1 | 钓鱼成功率+10% |

**制作流程**:
1. 查看配方
2. 检查材料
3. 开始制作（动画：锤击、组装）
4. 完成（物品添加到仓库）

**制作参数**:
- 时间消耗: 1-10分钟（游戏内）
- 失败率: 0-10%（根据制作技能等级）

### 4.7 家园升级

**房屋等级系统**:

| 等级 | 升级成本 | 仓库容量 | 解锁区域 | 新增功能 | 效率提升 |
|------|----------|----------|----------|----------|----------|
| Lv1（初始） | 无 | 50格 | 卧室+仓库 | 基础家具 | 基础 |
| Lv2 | 1000金币 | 100格 | 烹饪区 | 炉灶、料理台 | 休息效率+20% |
| Lv3 | 2000金币+500神力 | 200格 | 制作区 | 工作台、展示柜 | 所有效率+10% |

**Lv3额外特性**:
- 外观: 房屋扩建，更豪华
- 解锁高级制作配方

**升级动画流程**:
1. 桌宠祈祷
2. 神力笼罩房屋
3. 房屋发光、升级
4. 新区域出现
5. 桌宠欢呼入住

---

## 五、祭坛系统 (Altar)

### 5.1 场景概述

**主要功能**: 供奉物品、祈祷、与造物主沟通

**氛围**: 神圣、庄严、神秘

**视觉元素**:
- 石质祭坛（中央高台）
- 周围符文装饰
- 蜡烛和香炉
- 神圣光效
- 天空背景（更易看到神迹）

### 5.2 祭坛结构

**祭坛布局（正视图）**:

```
        [天空·神迹显现处]
              ↑↑↑
         [圣物悬浮槽]
       ﹝─────────﹞
         ③  ②  ①

    ════[供奉台]════
       [物品放置处]

    [桌宠站立位置]
         👤

  [符文圈·地面装饰]
```

*注: 这是视觉布局示意图，用于理解祭坛空间结构*

### 5.3 供奉台设计

**核心元素**:

**Altar类设计**:

供奉台数据结构包含:
- 祭坛等级(1-3级)
- 当前供品信息
- 圣物槽位(3个)
- 累积的祝福能量
- 放置供品功能:记录物品、桌宠、时间戳和仪式等级
- 仪式等级判定:根据物品神性值分为普通/稀有/传说

*(具体实现详见50-技术实现目录)*

### 5.4 供奉仪式场景

**普通仪式**:
**场景设置**:
- 基础光效
- 简单符文发光
- 柔和音乐

**动画参数**:
- 时长: 6秒
- 氛围: 日常而虔诚

**稀有仪式**:
**场景设置**:
- 中等光柱从天而降
- 符文环绕旋转
- 香炉烟雾缭绕
- 庄严圣歌

**动画参数**:
- 时长: 15秒
- 氛围: 庄重而神圣

**传说仪式**:
**场景设置**:
- 天空变色（金色/紫色）
- 巨大光柱贯穿天地
- 符文浮空飞舞
- 粒子效果爆发
- 雷鸣或瑞光
- 史诗音乐

**动画参数**:
- 时长: 30秒
- 氛围: 震撼而神圣

**特殊效果**:
- 全场景NPC都会停下观看

### 5.5 圣物系统

**圣物槽位**（祭坛上方悬浮）:

**槽位1（左）: 丰收圣物**
- 外观: 金色麦穗,旋转悬浮
- 光效: 温暖的金光
- 条件: 累计供奉100个作物

**槽位2（中）: 渔运圣物**
- 外观: 蓝色鱼形水晶
- 光效: 流动的水光
- 条件: 累计供奉50条鱼

**槽位3（右）: 美味圣物**
- 外观: 红色火焰皇冠
- 光效: 跳动的火焰
- 条件: 累计供奉30份烹饪食物

**凝结动画**:
1. 对应类型供奉达标
2. 祭坛震动
3. 能量汇聚成形
4. 圣物显现
5. 永久悬浮,提供光环

### 5.6 神谕交互点

**神谕石**（祭坛一侧）:

**外观**:
- 古老的石碑
- 刻有神秘符文
- 触摸时发光

**功能**:
- 桌宠可以在此祈求神谕
- 玩家可以给予提示
- 历史神谕记录

**交互流程**:
1. 桌宠走到神谕石前
2. 双手按在石碑上
3. 符文发光
4. 接收神谕（文字浮现）
5. 桌宠领悟,鞠躬感谢

### 5.7 祭坛升级

**祭坛等级**:

**Lv1（初始）**:
- 基础供奉功能
- 普通仪式
- 转化率: 100%

**Lv2（需要累计供奉50次+500神力）**:
- 解锁稀有仪式
- 转化率: +20% → 120%
- 解锁神谕系统
- 视觉: 祭坛变大,装饰更华丽

**Lv3（需要累计供奉150次+1000神力）**:
- 解锁传说仪式
- 转化率: +50% → 150%
- 解锁3个圣物槽位
- 可以同时供奉多个物品
- 视觉: 祭坛宏伟,光芒万丈

**升级动画**:
1. 现有祭坛包裹在神光中
2. 变形、升级
3. 新元素出现
4. 神迹显现庆祝

---

## 六、工作台系统 (Workbench)

### 6.1 场景概述

**主要功能**: 执行现实任务、学习技能、办公

**氛围**: 专注、高效、现代感

**视觉元素**:
- 办公桌和电脑
- 任务公告板
- 工具和文件
- 咖啡杯（装饰）
- 窗外风景

### 6.2 空间布局

**工作台场景（侧视图）**:

空间布局从上到下:
- 顶部: 任务公告板（显示待办任务）
- 中部: 办公桌和电脑设备
- 下部: 桌宠工作位置

### 6.3 任务公告板

**功能**: 显示玩家发布的任务队列

**公告板设计**:

**任务展示示例**:

*高优先级任务* ⭐:
- 任务: 整理桌面文件
- 预计: 15分钟
- 奖励: 120金币

*普通任务*:
- 任务: 打开VS Code
- 预计: 2分钟
- 奖励: 50金币

*定时任务*:
- 任务: 定时提醒喝水
- 频率: 每1小时
- 奖励: 30金币/次

**视觉设计**:
- 便签纸风格
- 不同颜色表示优先级
- 完成后飞出消失动画

### 6.4 任务执行动画

**执行流程**:

**1. 桌宠查看公告板**
- 走到公告板前
- 取下一张任务便签
- 阅读,思考表情

**2. 评估能力**
- 内心独白: "这个任务...我能完成吗？"
- 查看任务难度 vs 自己技能
- 决定: 接受/拒绝

**3. 接受任务**
- 点头："好,我来试试!"
- 走到办公桌前
- 坐下,打开电脑

**4. 执行中**（根据任务类型不同动画）

*简单任务（打开应用）*:
- 快速点击鼠标
- 2秒完成
- 满意表情

*中等任务（文件整理）*:
- 专注打字动画
- 偶尔停下思考
- 擦汗动作
- 5-15分钟

*复杂任务（数据处理）*:
- 长时间专注
- 表情严肃
- 可能喝咖啡提神
- 进度条显示
- 15-30分钟

**5. 完成**

*成功*:
- 桌宠站起,伸懒腰
- 开心表情："完成了!"
- 庆祝动画（击掌、跳跃）
- 奖励飘字显示
- 快乐度+15,经验增加

*失败*:
- 电脑屏幕显示错误
- 桌宠沮丧低头
- 对话: "对不起...我搞砸了"
- 快乐度-10
- 需要玩家安慰

**6. 休息**
- 离开办公桌
- 可能在窗边休息
- 或喝杯咖啡

### 6.5 技能学习区

**书架/教程区**:
**功能**: 学习新技能,提升任务成功率

**可学习技能**:
- 文件管理: 提升文件相关任务成功率
- 系统操作: 提升系统相关任务效率
- 数据处理: 解锁数据相关任务
- 网络搜索: 提升搜索任务质量

**学习流程**:
1. 桌宠从书架取书
2. 坐下阅读
3. 学习动画（翻页、思考）
4. 时间: 1-2游戏小时
5. 技能等级提升

**视觉效果**:
- 书本上方飘出知识符号（💡📖✨）
- 桌宠表情从疑惑到恍然大悟

### 6.6 工作台升级

**工作台等级系统**:

**Lv1（初始）**:
- 基础任务执行
- 只能执行简单任务
- 成功率: 80%

**Lv2（需要完成50个任务+300金币）**:
- 解锁中等任务
- 执行效率+20%
- 添加咖啡机（恢复体力）
- 成功率: 90%

**Lv3（需要完成200个任务+800金币）**:
- 解锁复杂任务
- 可以同时处理2个任务
- 添加第二台显示器
- 成功率: 95%
- 视觉: 办公区更专业

---

## 七、场景切换系统

### 7.1 场景连接

**场景连接图设计**:

场景邻接关系:
- 田地 ↔ 家、池塘
- 池塘 ↔ 田地、祭坛
- 家 ↔ 田地、工作台、祭坛
- 祭坛 ↔ 池塘、家
- 工作台 ↔ 家

移动时间(活动时间):
- 田地-家: 2游戏分钟 (约12现实秒)
- 田地-池塘: 3游戏分钟 (约18现实秒)
- 池塘-祭坛: 2游戏分钟 (约12现实秒)
- 家-祭坛: 3游戏分钟 (约18现实秒)
- 家-工作台: 1游戏分钟 (约6现实秒)

> **说明**: 场景移动使用活动时间(10x加速),因此移动速度较快。1游戏分钟 = 6现实秒。

*(具体实现详见50-技术实现目录)*

### 7.2 切换动画

**平滑过渡**:

**方式A: 淡入淡出**
- 当前场景淡出（0.5秒）
- 桌宠移动画面（可选显示）
- 新场景淡入（0.5秒）
- 总时长: 1秒

**方式B: 跟随桌宠**
- 镜头跟随桌宠移动
- 桌宠走出当前场景
- 镜头切换到新场景入口
- 桌宠走入新场景
- 总时长: 2-3秒

**选择**: MVP v1.0使用方式A（简单高效）

### 7.3 路径寻找

**路径寻找机制**:

桌宠使用最短路径算法自动规划场景间移动:
- 自动计算从当前场景到目标场景的最短路径
- 考虑所有可能的中转场景
- 计算总移动时间并显示给玩家

*(具体实现详见50-技术实现目录)*

---

## 八、实现要点

### 8.1 场景数据结构

**场景类实现设计**:

**Scene基类**:
- 场景标识(ID、名称)
- 背景资源管理
- 交互点集合
- NPC集合
- 天气状态
- 时间段状态
- 更新逻辑:天气效果、时间效果、交互点状态
- 渲染逻辑:背景、交互点、天气效果
- 抽象方法:获取可用动作(由子类实现)

**FarmScene田地场景**:
- 继承Scene基类
- 初始化土地格子集合(默认3块)
- 动作检测:
  - 检测可种植的空土地
  - 检测需要浇水的干旱土地
  - 检测可收获的成熟作物
- 返回桌宠可执行的动作列表

*(具体实现详见50-技术实现目录)*

### 8.2 性能优化

**SceneManager场景管理器设计**:

**核心功能**:
- 场景集合管理(Map存储)
- 当前场景追踪
- 已加载场景集合管理

**预加载优化**:
- 预加载相邻场景:根据场景图预加载相邻场景资源
- 卸载远离场景:卸载非相邻场景释放内存
- 提升切换性能

**场景切换流程**:
1. 保存当前场景状态并触发退出事件
2. 加载目标场景并触发进入事件
3. 预加载相邻场景
4. 卸载远离场景
5. 确保流畅的场景切换体验

*(具体实现详见50-技术实现目录)*

---

## 九、测试验证

### 9.1 功能测试用例

**测试用例1: 场景切换**

*前置条件*: 桌宠在田地场景

*执行步骤*:
1. 桌宠决定去池塘钓鱼
2. 触发场景切换
3. 观察过渡动画
4. 确认到达池塘场景

*预期结果*:
- ✅ 切换动画流畅（30fps+）
- ✅ 切换时间符合设定（3分钟游戏内时间）
- ✅ 桌宠正确出现在池塘场景
- ✅ 池塘交互点可用

**测试用例2: 作物完整周期**

*前置条件*: 有空土地和种子

*执行流程*:
1. 种植萝卜（2天周期）
2. 每6小时浇一次水
3. 等待2天
4. 收获

*预期结果*:
- ✅ 作物正确经历5个生长阶段
- ✅ 缺水时生长减慢
- ✅ 2天后可收获
- ✅ 收获后土地恢复空

**测试用例3: 仓库容量管理**

*前置条件*: 仓库初始50容量

*执行流程*:
1. 收获大量作物
2. 尝试存入超过50个物品

*预期结果*:
- ✅ 达到容量上限时提示"仓库已满"
- ✅ 相同物品正确堆叠
- ✅ UI显示正确的使用率

### 9.2 性能测试

**性能指标**:

**场景渲染**:
- 帧率: ≥30fps（单场景）
- 内存: <50MB/场景

**场景切换**:
- 延迟: <100ms
- 无卡顿感

**批量更新**:
- 10个作物同时生长: 无性能影响
- 50个物品仓库: UI响应<50ms

---

## 十、未来扩展

### 10.1 新场景（MVP v3.0+）

**森林场景**:
- 功能: 采集、探险、遇见野生动物
- 资源: 木材、野果、药草

**海滩场景**:
- 功能: 垂钓海鱼、拾取贝壳、冲浪娱乐
- 资源: 海鲜、珍珠、珊瑚

**山顶场景**:
- 功能: 俯瞰世界、冥想、观星
- 资源: 矿石、稀有植物

### 10.2 场景动态天气交互

**高级天气效果**:
- 暴雨: 田地可能积水
- 大雪: 池塘结冰,田地覆盖
- 台风: 作物倒伏,需要扶正
- 干旱: 土地龟裂加剧,需要大量浇水

### 10.3 场景间生态链

**生态互动**:
- 池塘的鱼群受上游（假想）雨水影响
- 田地的作物吸引池塘的青蛙（益虫）
- 家中的灯光吸引夜间昆虫
- 祭坛的神圣气息净化周围环境

---

## 十一、总结

场景系统是游戏世界的物理基础，五大核心场景各有特色：

- **田地**: 辛勤劳作，丰收喜悦
- **池塘**: 宁静垂钓，休闲观赏
- **家**: 温馨舒适，生活中心
- **祭坛**: 神圣庄严，信仰连接
- **工作台**: 专注高效，虚实桥梁

**设计关键**:
1. 每个场景功能明确且不可替代
2. 场景间有机关联，形成生态
3. 视觉风格区分度高
4. 可扩展性强，支持后续内容

**实现优先级**:
- P0 (MVP v1.0): 五大核心场景基础功能
- P1 (MVP v1.5): 场景细节动画和交互
- P2 (MVP v2.5): 场景升级系统
- P3 (MVP v3.0+): 新场景扩展

---

**场景是桌宠的家，也是玩家观察的舞台。** 🏡



---

## 7. 工具交互系统集成

### 7.1 场景工具交互点设计

每个场景包含多个工具交互点,需要特定工具才能触发。

#### 7.1.1 家园场景工具交互

**农田区域**:
- 未开垦荒地: 需要锄头进行翻土开垦
- 已耕种农田: 使用修枝剪/洒水壶加速生长
- 收获时刻: 镰刀/采集篮收割作物

**建筑区域**:
- 空地: 锤子+锯子建造新建筑(需图纸+工具书)
- 损坏建筑: 锤子+修理工具包修复
- 可升级建筑: 高级建筑工具套装升级扩建

**装饰区域**:
- 花园: 园艺剪+洒水壶美化环境(美观度+5,快乐度+2)
- 工作台: 各类制作工具制作物品

**隐藏区域**:
- 地下室入口: 铲子LV3+挖掘解锁(额外50格储物空间)
- 神秘宝箱: 万能钥匙/开锁工具开启(每月刷新)

*(详细配置详见50-技术实现目录)*

#### 7.1.2 森林场景工具交互

**树木资源**:
- 普通树木: 木斧砍伐获得木材(24小时刷新)
- 古树: 精钢伐木斧LV3+砍伐(硬木+稀有材料,7天刷新)
- 魔法树: 元素切割斧采集魔法精华(不杀死树木,需《元素采掘秘典》)

**矿脉区域**:
- 露天矿石: 石镐采矿(铜矿/铁矿/石头)
- 矿洞入口: 镐+矿灯进入探索(深层矿脉,有怪物)
- 稀有矿脉: 秘银镐+探矿罗盘开采(秘银/精金/魔法水晶)
- 虚空矿脉: 虚空镐采集(极稀有材料,专家级可见)

**采集点**:
- 药草丛: 采集篮推荐(采集草药)
- 蘑菇圈: 采集刀采集(需识别技能)
- 浆果丛: 手工采集(采集篮提升效率50%)

**隐藏探索**:
- 密林深处: 砍刀+指南针开辟道路(发现古代遗迹/精灵聚落/稀有资源点/Boss巢穴)
- 巨石阵: 创世之锤激活远古传送门(解锁秘境副本,专家级工具+特殊任务)

*(详细配置详见50-技术实现目录)*

#### 7.1.3 神殿场景工具交互

**供奉祭坛**:
- 普通祭坛: 供奉容器(篮子/托盘)放置供品获得神力
- 高级祭坛: 圣器容器进行特殊供奉仪式(需神殿声望LV3)

**神力水晶**:
- 充能水晶: 魔法导管传输神力为工具附魔
- 净化水晶: 净化法杖净化受损工具(50神力点数)

**工具祝福台**:
- 基础祝福: 消耗100神力祝福工具(永久+5%效率,最多3次)
- 神圣锻造: 专家级工具+神圣材料锻造神器(1000神力+稀有材料)

**知识圣殿**:
- 古籍书架: 读书镜研读古籍(智力80+,神殿声望LV5)
- 技艺传承碑: 拓印工具学习专属技能(神圣锻造术/永恒耐久附魔/工具共鸣技法)

*(详细配置详见50-技术实现目录)*

### 7.2 工具解锁隐藏内容

特定工具是解锁场景隐藏区域和触发特殊事件的钥匙。

#### 7.2.1 隐藏区域解锁条件

**家园场景隐藏内容**:
- 地下宝库: 精铁铲子LV4挖掘特定位置100次(提示:家园角落异常松软的土地,奖励:1000金币+稀有工具书)
- 阁楼密室: 撬锁工具+梯子打开锁住的阁楼(提示:房屋顶部可疑的门,奖励:古董家具+装饰图纸)
- 魔法花园: 魔法锄头+生命之剪培育魔法植物(花园转化为魔法花园,产出魔法材料)

**森林场景隐藏内容**:
- 精灵树屋: 元素切割斧开辟道路(砍伐<5棵树,奖励:精灵NPC+特殊交易)
- 远古矿坑: 探矿罗盘+秘银镐定位并打开封印入口(需解谜+战斗,奖励:稀有矿石+远古工具图纸)
- 元素圣地: 全知之眼激活四元素柱(需收集四种元素工具,奖励:元素融合能力+专属副本)

**神殿场景隐藏内容**:
- 圣物库: 神圣钥匙解锁(完成神殿所有试炼,奖励:神器工具+神性材料)

*(详细配置详见50-技术实现目录)* 
