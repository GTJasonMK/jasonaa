
# 11-桌宠AI与需求系统

> **文档版本**: v1.1 (需求衰减优化)
> **最后更新**: 2025-10-31
> **负责人**: 待定
> **优先级**: ⭐⭐⭐⭐⭐ (核心基础)
> **实现版本**: MVP v1.0

---

## 📋 相关文档

**前置依赖**: 
- [10-场景系统](./10-场景系统.md) - AI需要知道场景和交互点

**相关文档**:
- [14-供奉系统](./14-供奉系统.md) - 供奉决策
- [15-任务系统](./15-任务系统.md) - 任务接受决策
- [30-个性化系统](../30-扩展系统/30-个性化系统.md) - 特质影响AI
- [52-AI实现方案](../50-技术实现/52-AI实现方案.md) - 技术实现

---

## 一、系统概述

### 1.1 设计理念

桌宠AI系统是游戏的**灵魂**,决定了桌宠是否"活着"。

**核心原则**:
1. **自主性优先**: 桌宠自己决策,玩家不能直接控制
2. **需求驱动**: 行为由内在需求驱动,而非外部命令
3. **可观察性**: 决策过程要让玩家能感知和理解
4. **个性化**: 不同桌宠有不同的行为倾向

### 1.2 系统目标

1. **创造真实感**: 桌宠看起来像"活物",而非机械执行脚本
2. **维持平衡**: 桌宠能自给自足,不会陷入死循环
3. **提供观察乐趣**: 玩家通过观察AI决策获得乐趣
4. **支持玩家影响**: 玩家可以通过间接方式影响AI决策

---

## 二、需求系统

### 2.1 五大核心需求

桌宠有5个核心需求,所有行为都围绕满足这些需求展开。

#### 需求1: 饥饿度 (Hunger)

**数值范围**: 0-100

**衰减机制**:

> **注意**: 以下为基础设计值（游戏内时间），实际在线衰减已在v1.1中降低80%，详见[2.3节需求衰减优化](#23-需求衰减优化--v11核心更新)

**饥饿度衰减速度**（游戏内基础设计）:

| 状态 | 衰减速度 | 说明 |
|------|----------|------|
| 基础衰减 | -5/游戏小时 | 正常状态下的衰减 |
| 工作时 | -7/游戏小时 | 种植、收获等工作活动 |
| 运动时 | -8/游戏小时 | 剧烈活动 |
| 睡眠时 | -2/游戏小时 | 睡眠状态减缓消耗 |

**季节修正系数**:

| 季节 | 修正系数 | 说明 |
|------|----------|------|
| 冬季 | ×1.5 | 消耗增加50% |
| 夏季 | ×0.9 | 消耗降低10% |
| 春秋 | ×1.0 | 正常消耗 |

**影响效果**:
| 饥饿度 | 状态 | 影响 |
|--------|------|------|
| 100-80 | 饱腹 | 无影响 |
| 80-50 | 正常 | 无影响 |
| 50-30 | 饥饿 | 开始寻找食物,心情-5 |
| 30-10 | 很饿 | 工作效率-30%,心情-15 |
| 10-0 | 饥荒 | 健康度开始下降(-5/小时),无法工作 |

**恢复方式**:
- 食用作物: +20~40 (根据作物类型)
- 食用鱼类: +25~50
- 食用烹饪食物: +50~100
- 特殊食物: 额外效果(buff)

---

#### 需求2: 疲劳度 (Fatigue)

**数值范围**: 0-100 (100为完全清醒,0为精疲力竭)

**衰减机制**:

> **注意**: 以下为基础设计值（游戏内时间），实际在线衰减已在v1.1中降低80%，详见[2.3节需求衰减优化](#23-需求衰减优化--v11核心更新)

**疲劳度变化速度**（游戏内基础设计）:

| 活动类型 | 变化速度 | 说明 |
|----------|----------|------|
| 种植/钓鱼/收获 | -8/游戏小时 | 体力劳动 |
| 执行任务 | -10/游戏小时 | 根据任务难度浮动 |
| 轻度活动 | -5/游戏小时 | 日常走动、整理等 |
| 散步/观景 | -3/游戏小时 | 休闲活动 |
| 睡眠 | +15/游戏小时 | 最佳恢复方式 |
| 坐着休息 | +5/游戏小时 | 被动恢复 |

**影响效果**:
| 疲劳度 | 状态 | 影响 |
|--------|------|------|
| 100-80 | 精力充沛 | 工作效率+10% |
| 80-40 | 正常 | 无影响 |
| 40-20 | 疲惫 | 工作效率-30%,动作变慢 |
| 20-0 | 精疲力竭 | 工作效率-70%,强制休息 |

**特殊机制**:
- 疲劳度<20时,AI会强制选择休息行为
- 连续工作超过4游戏小时,疲劳度加速下降(×1.5)
- 夜间(22:00-5:00)不睡觉,疲劳度×2倍下降

---

#### 需求3: 快乐度 (Happiness)

**数值范围**: 0-100

**影响因素** (复杂系统):

**正面因素**:
- 好天气(晴天): +5/天
- 收获成功: +10/次
- 钓到稀有鱼: +15/次
- 完成任务: +5~20 (根据难度)
- 供奉被接受: +10
- 供奉获得赐福: +20
- 目睹神迹: +15
- 美化环境: +5/天 (装饰品)
- 节日: +10~30

**负面因素**:
- 坏天气(暴雨): -10/天
- 收获失败/作物枯萎: -5/次
- 任务失败: -10/次
- 供奉被拒绝: -3
- 健康度<50: -5/天
- 饥饿度<30: -10/天
- 连续工作无休息: -5/天

**影响效果**:
| 快乐度 | 状态 | 影响 |
|--------|------|------|
| 100-80 | 非常开心 | 工作效率+20%,主动唱歌/跳舞 |
| 80-50 | 愉快 | 正常状态 |
| 50-30 | 低落 | 工作效率-10%,表情忧郁 |
| 30-10 | 沮丧 | 工作效率-30%,可能发呆 |
| 10-0 | 抑郁 | 拒绝工作,只进行基本生存活动 |

**特殊互动**:
- 快乐度<30时,玩家可以通过祝福、好天气、赐福等方式提升
- 快乐度>80时,桌宠会主动进行供奉(表达感恩)

---

#### 需求4: 健康度 (Health)

**数值范围**: 0-100

**衰减机制**:

**健康度变化规则**:

| 条件 | 变化速度 | 说明 |
|------|----------|------|
| 健康>50 且休息充足 | +2/游戏小时 | 自然恢复 |
| 健康<50 | 0 | 不自然恢复 |
| 饥饿度<10 | -5/游戏小时 | 饥饿损害健康 |
| 疲劳度<10 | -3/游戏小时 | 过度疲劳损害健康 |
| 污染环境 | -2/游戏小时 | 环境因素 |
| 疾病状态 | -10/游戏小时 | 生病状态 |

**影响效果**:
| 健康度 | 状态 | 影响 |
|--------|------|------|
| 100-80 | 健康 | 无影响 |
| 80-50 | 正常 | 无影响 |
| 50-30 | 虚弱 | 行动速度-30%,容易疲劳 |
| 30-10 | 生病 | 行动速度-60%,无法工作 |
| 10-0 | 重病 | 只能躺在床上,需要玩家干预 |

**恢复方式**:
- 充足睡眠: +5/游戏小时
- 营养食物: +10/次
- 玩家祝福(健康祝福): +50立即恢复
- 特殊药品: +30

---

#### 需求5: 虔诚度 (Faith)

**数值范围**: 0-100

**这是本游戏的核心创新需求**

**衰减机制**:

**虔诚度变化规则**:

| 事件类型 | 变化值 | 说明 |
|----------|--------|------|
| 自然衰减 | -2/生命天 (约-0.083/生命小时) | 基础衰减,按1:1生命时间计算 |
| 连续7天无供奉 | -5/生命天 | 衰减加速 |
| 供奉被拒绝 | -5/次 | 负面事件 |
| 供奉被接受 | +5/次 | 正面反馈 |
| 供奉获得赐福 | +10/次 | 强正面反馈 |
| 目睹神迹 | +8/次 | 见证奇迹 |
| 玩家使用神力 | +3/次 | 感受神力 |

**影响效果**:
| 虔诚度 | 状态 | 影响 |
|--------|------|------|
| 100-90 | 虔诚信徒 | 供奉转化率+50%,主动供奉频率高 |
| 90-80 | 虔诚 | 供奉转化率+20%,经常供奉 |
| 80-60 | 信徒 | 正常供奉频率 |
| 60-40 | 普通 | 供奉意愿降低 |
| 40-20 | 怀疑 | 很少供奉,可能质疑 |
| 20-0 | 失信 | 不再供奉,触发信仰危机 |

**特殊机制**:
- 虔诚度<50时,桌宠会主动前往祭坛供奉(补偿机制)
- 虔诚度>80时,桌宠会在获得好收成后主动供奉(感恩机制)
- 虔诚度<20时,触发[信仰危机事件](../10-核心系统/14-供奉系统.md#信仰危机)

---

### 2.3 需求衰减优化 ⭐ (v1.1核心更新)

> **重要更新**: 配合双时间系统，优化需求衰减平衡性

#### 2.3.1 在线状态衰减调整

为避免玩家需要过于频繁关注需求，所有在线衰减速度降低80%：

**在线状态需求衰减调整 (降低80%)**:

**饥饿度衰减**:

| 状态 | 原值 | 新值 | 现实时间换算 |
|------|------|------|--------------|
| 基础衰减 | -5/游戏小时 | -1/游戏小时 | -0.167/现实分钟 |
| 工作时 | -7/游戏小时 | -1.4/游戏小时 | -0.233/现实分钟 |
| 运动时 | -8/游戏小时 | -1.6/游戏小时 | -0.267/现实分钟 |
| 睡眠时 | -2/游戏小时 | -0.4/游戏小时 | -0.067/现实分钟 |

**疲劳度衰减**:

| 活动类型 | 原值 | 新值 | 现实时间换算 |
|----------|------|------|--------------|
| 种植/钓鱼 | -8/游戏小时 | -1.6/游戏小时 | -0.267/现实分钟 |
| 执行任务 | -10/游戏小时 | -2/游戏小时 | -0.333/现实分钟 |
| 轻度活动 | -5/游戏小时 | -1/游戏小时 | -0.167/现实分钟 |
| 散步 | -3/游戏小时 | -0.6/游戏小时 | -0.100/现实分钟 |

**设计效果**:
- ✓ 玩家在线5小时才需要频繁关注需求
- ✓ 避免"保姆式"微操
- ✓ 更轻松的游戏体验

#### 2.3.2 离线保护机制 ⭐⭐⭐

**核心原则**: "桌宠会进入思念模式，静静等待主人回来，不会因离线而死亡"

**离线保护机制 (降低95%)**:

| 需求 | 在线衰减 | 离线衰减 | 离线8小时影响 | 最低保护值 | 特殊机制 |
|------|----------|----------|---------------|------------|----------|
| 饥饿度 | -0.167/分钟 | -0.00835/分钟 | -4.0 (100→96.0) | 20 | 不会致死 |
| 疲劳度 | -0.167/分钟 | -0.00835/分钟 | -4.0 (100→96.0) | 20 | 安全范围 |
| 快乐度 | 依活动而定 | 不衰减 | 无影响 | - | 思念提升虔诚度 |
| 健康度 | 依状态而定 | 不衰减 | 无影响 | - | 除非重病状态 |
| 虔诚度 | -0.083/生命小时 (-2/生命天) | 不衰减 | 无影响 | - | 长时间离线+15 |

#### 2.3.3 离线回归机制

**离线回归补偿系统**:

| 离线时长 | 需求影响 | 回归反应 | 补偿奖励 | 需求状态 |
|----------|----------|----------|----------|----------|
| <1小时 | 几乎无 | "欢迎回来!" | 无 | 正常 |
| 1-4小时 | 轻微下降 | "你回来啦!我在等你~"<br>开心迎接动画 | 无 | 正常 |
| 4-12小时 | 中等下降 | "终于等到你了!(ಥ_ಥ)"<br>激动扑过来动画 | • 思念奖励: +50神力<br>• 亲密度: +5<br>• 特殊对话 | 饥饿60+<br>疲劳70+<br>健康80+ |
| >12小时 | 较大下降<br>(不致命) | "重逢"特殊事件<br>含泪重逢拥抱动画<br>桌宠讲述梦境故事 | • 思念礼物: 稀有物品<br>• 亲密度: +10<br>• 虔诚度: +15<br>• 成就: "穿越时光的等待" | 饥饿40+<br>疲劳50+<br>健康70+ |

#### 2.3.4 特质影响调整

**美食家特质优化** (从"诅咒"变成"有代价的优势"):

**美食家特质优化**:

| 属性 | 原设计 | 新设计 | 改善效果 |
|------|--------|--------|----------|
| 在线饥饿衰减 | +20% | +10% | 代价更小<br>-0.167 → -0.184/现实分钟 |
| 离线饥饿衰减 | +20% | 不增加 | 离线安全<br>与普通桌宠相同 |
| 食物饱腹效果 | +30% | +50% | 补偿增加的消耗<br>胡萝卜: 30→45<br>烤鱼: 60→90 |
| 食物快乐加成 | +40% | +60% | 强化优势<br>美食带来更多快乐 |

**设计结论**: 美食家现在是"有特色的优势特质"而非"诅咒"


---

### 2.2 需求优先级系统

并非所有需求都同等重要,AI会根据需求的紧急程度排序:

**配置数据(待重构)**:

**需求紧急度计算逻辑**:

**饥饿度 (hunger)**:
- 数值 < 10: 紧急度 = 100 (生存威胁)
- 数值 < 30: 紧急度 = 80
- 数值 < 50: 紧急度 = 50

**健康度 (health)**:
- 数值 < 10: 紧急度 = 100 (生存威胁)
- 数值 < 30: 紧急度 = 90
- 数值 < 50: 紧急度 = 60

**疲劳度 (fatigue)**:
- 数值 < 10: 紧急度 = 90
- 数值 < 20: 紧急度 = 70
- 数值 < 40: 紧急度 = 40

**快乐度 (happiness)**:
- 数值 < 10: 紧急度 = 50
- 数值 < 30: 紧急度 = 30

**虔诚度 (faith)**:
- 数值 < 20: 紧急度 = 40
- 数值 < 50: 紧急度 = 20

**优先级规则**:
1. **生存需求** (饥饿<10, 健康<10) - 最高优先级,必须立即处理
2. **紧急需求** (饥饿<30, 疲劳<20) - 高优先级,尽快处理
3. **维持需求** (虔诚度<50) - 中等优先级,有空就处理
4. **优化需求** (快乐度提升) - 低优先级,锦上添花

---

## 三、AI决策系统

### 3.1 决策架构

采用**效用理论 (Utility Theory)** 作为核心决策框架。

**决策流程**:
1. 评估当前需求状态
2. 列举所有可能的行为选项
3. 计算每个行为的效用值
4. 选择效用最高的行为
5. 执行行为
6. 更新世界状态

### 3.2 效用计算

每个行为都有一个效用值,由多个因素综合计算:

**配置数据(待重构)**:

**行为效用计算逻辑**:

**1. 需求满足度**
- 评估行为能满足多少需求
- 满足度 × 10 = 基础效用值

**2. 成功概率**
- 评估行为成功的可能性
- 效用值 × 成功概率 = 调整后效用

**3. 时间成本**
- 行为所需时间
- 效用值 - (时间 × 0.5) = 扣除时间成本

**4. 体力成本**
- 行为消耗的体力
- 如果体力不足: 效用值 × 0.3 (大幅降低)

**5. 环境因素**
- 当前环境对行为的加成
- 效用值 + 环境加成

**6. 特质修正**
- 桌宠特质对行为的影响
- 效用值 × 特质修正系数

**7. 随机因素**
- 增加不可预测性
- 效用值 + 随机值(0-5)

### 3.3 行为列表

桌宠可以执行的所有行为:

#### 工作行为

**种植 (Plant)**:

**配置数据(待重构)**:
- **类型**: 工作行为
- **场景要求**: 农田
- **前置条件**: 有空土地 && 有种子
- **体力消耗**: 5点
- **时间**: 2-5分钟
- **产出**: 未来收获
- **需求影响**: 疲劳 -5, 快乐 +2
- **效用评估**: 间接满足饥饿度(未来), 优先级中等

**浇水 (Water)**:

**配置数据(待重构)**:
- **类型**: 工作行为
- **场景要求**: 农田/池塘
- **前置条件**: 有干旱土地
- **体力消耗**: 3点
- **时间**: 1-2分钟/块
- **产出**: 作物生长加速
- **需求影响**: 疲劳 -3, 快乐 +1
- **效用评估**: 维护作物, 优先级中等

**收获 (Harvest)**:

**配置数据(待重构)**:
- **类型**: 工作行为
- **场景要求**: 农田
- **前置条件**: 有成熟作物
- **体力消耗**: 4点
- **时间**: 1-3分钟
- **产出**: 作物进入仓库
- **需求影响**: 疲劳 -4, 快乐 +10
- **效用评估**: 获得食物/供品, 优先级高

**钓鱼 (Fish)**:

**配置数据(待重构)**:
- **类型**: 工作行为
- **场景要求**: 池塘
- **前置条件**: 水质正常
- **体力消耗**: 6点
- **时间**: 5-15分钟
- **产出**: 鱼类(概率性)
- **需求影响**: 疲劳 -6, 快乐 +5(成功)/-2(失败)
- **效用评估**: 获得食物/供品, 优先级中等

#### 生活行为

**进食 (Eat)**:

**配置数据(待重构)**:
- **类型**: 生活行为
- **场景要求**: 家
- **前置条件**: 仓库有食物
- **体力消耗**: 0点
- **时间**: 2-5分钟
- **产出**: 饥饿度恢复
- **需求影响**: 饥饿 +30~80(根据食物), 快乐 +5~15
- **效用评估**: 满足饥饿度, 优先级高(饥饿<50时)

**睡觉 (Sleep)**:

**配置数据(待重构)**:
- **类型**: 生活行为
- **场景要求**: 家
- **前置条件**: 有床
- **体力消耗**: 0点
- **时间**: 6-8游戏小时
- **产出**: 体力恢复
- **需求影响**: 疲劳 +90~100, 健康 +10
- **效用评估**: 满足疲劳度, 优先级高(疲劳<30时)

#### 供奉行为

**供奉 (Offer)**:

**配置数据(待重构)**:
- **类型**: 信仰行为
- **场景要求**: 祭坛
- **前置条件**: 仓库有可供奉物品
- **体力消耗**: 2点
- **时间**: 3-30分钟(根据仪式等级)
- **产出**: 神力点数(给玩家)
- **需求影响**: 虔诚度 +5~10, 快乐 +10~20
- **效用评估**: 满足虔诚度, 优先级中等(虔诚度<50时变高)

#### 任务行为

**接受任务 (AcceptTask)**:

**配置数据(待重构)**:
- **类型**: 任务行为
- **场景要求**: 工作台
- **前置条件**: 任务队列非空 && 技能足够
- **体力消耗**: 0点
- **时间**: 1分钟
- **产出**: 任务进入进行中
- **效用评估**: 获得金币(间接), 优先级低~中等

**执行任务 (ExecuteTask)**:

**配置数据(待重构)**:
- **类型**: 任务行为
- **场景要求**: 工作台
- **前置条件**: 有进行中的任务
- **体力消耗**: 10~30点(根据任务难度)
- **时间**: 5-30分钟(根据任务)
- **产出**: 任务完成,获得奖励
- **需求影响**: 疲劳 -10~-30, 快乐 +15(成功)/-10(失败)
- **效用评估**: 获得金币, 优先级中等

#### 休闲行为

**散步 (Walk)**:

**配置数据(待重构)**:
- **类型**: 休闲行为
- **场景要求**: 任意
- **前置条件**: 无
- **体力消耗**: 3点
- **时间**: 5-10分钟
- **产出**: 无
- **需求影响**: 疲劳 -3, 快乐 +5
- **效用评估**: 提升快乐度, 优先级低

**发呆 (Idle)**:

**配置数据(待重构)**:
- **类型**: 休闲行为
- **场景要求**: 任意
- **前置条件**: 无事可做
- **体力消耗**: 0点
- **时间**: 2-5分钟
- **产出**: 无
- **需求影响**: 疲劳 +2, 快乐 -1
- **效用评估**: 无需求满足, 优先级最低(兜底行为)

---

### 3.4 决策示例

**场景: 早晨7:00,桌宠刚醒来**

```
配置数据(待重构):
当前状态:
- 饥饿度: 40 (有点饿)
- 疲劳度: 95 (精力充沛)
- 快乐度: 65 (正常)
- 健康度: 90 (健康)
- 虔诚度: 55 (普通)

仓库:
- 萝卜 × 2
- 小鱼 × 1
- 种子 × 5

场景状态:
- 田地: 2块空地,1块湿润有作物(未成熟)
- 池塘: 水质清澈
- 祭坛: 空

可选行为评估:
1. 进食 (吃萝卜):
   - 需求满足: 饥饿度+30 → 效用 = 30 × 10 = 300
   - 成功率: 100% → 效用 = 300 × 1.0 = 300
   - 时间成本: 3分钟 → 效用 = 300 - 3×0.5 = 298.5
   - 体力成本: 0 → 无影响
   - 最终效用: 298.5

2. 种植作物:
   - 需求满足: 未来收获 → 效用 = 50 × 10 = 500
   - 成功率: 95% → 效用 = 500 × 0.95 = 475
   - 时间成本: 5分钟 → 效用 = 475 - 5×0.5 = 472.5
   - 体力成本: 5,当前95 → 无影响
   - 早晨加成: +10%
   - 最终效用: 519.75

3. 钓鱼:
   - 需求满足: 获得鱼 → 效用 = 60 × 10 = 600
   - 成功率: 80% → 效用 = 600 × 0.8 = 480
   - 时间成本: 10分钟 → 效用 = 480 - 10×0.5 = 475
   - 体力成本: 6,当前95 → 无影响
   - 最终效用: 475

4. 供奉 (萝卜):
   - 需求满足: 虔诚度+5 → 效用 = 5 × 10 = 50
   - 快乐度+10 → 效用 += 10 × 10 = 150
   - 虔诚度55,未达到紧急(<50) → 权重0.8
   - 最终效用: 150 × 0.8 = 120

决策结果: 选择"种植作物" (效用519.75最高)

AI思考:
"早晨精力充沛,虽然有点饿但不急,先种植作物,之后再吃饭。"
```

---

