# 12-时间与天气系统

> **文档版本**: v1.0
> **系统优化**: 包含v1.1双时间系统与离线保护优化方案
> **最后更新**: 2025-10-28
> **负责人**: 待定
> **优先级**: ⭐⭐⭐⭐ (核心系统)
> **实现版本**: MVP v1.0

---

## 📋 相关文档

**前置依赖**: 无

**相关文档**:
- [10-场景系统](./10-场景系统.md) - 天气影响场景
- [11-桌宠AI与需求系统](./11-桌宠AI与需求系统.md) - 时间影响需求
- [16-神力系统](./16-神力系统.md) - 玩家控制天气

---

## 一、系统概述

### 1.1 设计理念

时间与天气系统是游戏世界的**节奏控制器**,为游戏带来真实感和变化性。

**核心原则**:
1. **真实感**: 模拟真实的昼夜和季节变化
2. **影响力**: 时间和天气显著影响游戏玩法
3. **可控性**: 玩家可以通过神力影响天气
4. **节奏感**: 为游戏提供自然的节奏变化

### 1.2 系统目标

1. **创造氛围**: 通过时间和天气营造不同氛围
2. **增加策略性**: 玩家需要考虑时间和天气因素
3. **提供变化**: 避免游戏过于单调
4. **支持成长**: 季节系统提供长期目标

---

## 二、时间系统

### 2.1 时间流速

**基础流速**:
- 现实1秒对应游戏1分钟
- 现实1分钟对应游戏1小时
- 现实24分钟构成1个游戏日
- 现实2.8小时为1个游戏周
- 现实12小时为1个游戏月
- 现实2天即为1个游戏年

**时间控制** (神力系统):
- 玩家可以加速时间: ×2, ×4速度
- 玩家可以暂停时间: 游戏时间静止
- 玩家不能倒流时间 (特殊神力除外)


### 2.1.1 双时间系统设计 ⭐ (核心优化)

> **重要更新 v1.1**: 为平衡即时反馈与长期陪伴，引入双时间系统

**设计理念**:
游戏采用**双时间轨道**，不同系统使用不同的时间流速，既保证日常活动的即时反馈，又维护生命成长的真实感。

#### 活动时间 (Activity Time)

**流速**: `1现实分钟 = 10游戏分钟` (10倍加速)

**适用系统**:

活动时间影响以下游戏内容:
- 作物生长与收获
- 钓鱼等待时间
- 烹饪制作时间
- 天气变化周期
- 昼夜循环(视觉)
- 日常活动节奏

**时间换算**:

- 1 现实分钟 = 10 游戏分钟
- 1 现实小时 = 10 游戏小时
- 2.4 现实小时 = 1 游戏天(24小时)
- 16.8 现实小时 = 1 游戏周
- 3.5 现实天 = 1 游戏月

**设计目标**: 
- 作物3-5现实分钟可收获，避免等待
- 钓鱼1-3现实分钟有反馈
- 一天内可体验完整昼夜循环

#### 生命时间 (Life Time)

**流速**: `1现实小时 = 1游戏小时` (1:1真实时间)

**适用系统**:

生命时间影响以下游戏内容:
- 桌宠年龄增长
- 生命阶段转换
- 关系发展进度
- 工具书学习时间
- 技能熟练度积累
- 长期成就统计

**时间换算**:

- 1 现实小时 = 1 生命小时
- 24 现实小时 = 1 生命天
- 7 现实天 = 1 生命周
- 30 现实天 = 1 生命月

**设计目标**:
- 桌宠生命周期延长至180+现实天
- 真正的"长期陪伴"情感价值
- 学习、成长需要真实时间投入

### 2.1.2 离线保护机制 ⭐ (核心优化)

> **重要更新 v1.1**: 避免强制在线，让玩家安心离线

**离线时的时间处理**:

玩家离线期间，系统将采取以下行为：

- **活动时间**：完全暂停流动，确保作物生长、资源衰减等即时性活动不受影响，天气和场景状态将维持在玩家离线时的瞬间，旨在避免玩家错过任何重要时刻。
- **生命时间**：按照1:1的现实时间比例持续流动，这意味着桌宠的年龄会自然增长，关系冷却机制将继续生效，工具书的理论学习进度也会累积（仅限于理论部分），以保证生命的连续性，不因离线而停滞。

**离线需求衰减机制**:

离线状态下，桌宠的需求衰减将大幅降低95%，以确保其生存安全。

- **在线状态（正常衰减）**：
  - 饥饿度：每现实分钟下降0.3点。
  - 疲劳度：每现实分钟下降0.25点。
  - 快乐度：根据桌宠活动情况动态变化。
  - 健康度：若存在负面状态，每现实分钟下降0.05点。
  - 虔诚度：每现实分钟下降0.002点。

- **离线状态（降低95%衰减）**：
  - 饥饿度：每现实分钟仅下降0.015点（离线8小时仅下降7.2点）。
  - 疲劳度：每现实分钟仅下降0.0125点（离线8小时仅下降6点）。
  - 快乐度：不衰减。
  - 健康度：不衰减（除非桌宠处于重病状态）。
  - 虔诚度：不衰减。
  - **需求最低值**：所有需求值最低将保持在20点，确保桌宠不会因离线而死亡。

**离线保护原则**：桌宠将进入“思念模式”，静静等待主人回归。

**离线补偿机制**:

| 离线时长 | 影响 | 回归反应 | 补偿奖励 |
|---------|------|---------|---------|
| <1小时 | 无 | "欢迎回来!" | 无 |
| 1-4小时 | 需求轻微下降 | "你回来啦!我在等你~" | 无，开心迎接动画 |
| 4-12小时 | 需求中等下降 | "终于等到你了!(ಥ_ಥ)" | 思念奖励+50神力，关系+5 |
| >12小时 | 需求较大下降 | 触发"重逢"剧情 | 思念礼物(稀有物品)，关系+10，虔诚+15 |

**离线学习机制**:

如果离线时正在学习工具书:
- 自动继续理论学习
- 学习速度: 智力 × 0.3% / 分钟
- 最多累积到30%(需要玩家参与实践)
- 回归时触发"学习成果展示"
- 对话: "主人!你看我学会这么多了!"

### 2.1.3 离线行为完全对照表 ⭐ (系统整合)

> **系统整合说明**: 本表汇总了所有游戏系统在玩家离线时的行为，提供统一的参考标准

**离线行为分类**:
- ⏸️ **暂停**: 完全停止，保持离线时状态
- ▶️ **继续**: 按正常或特定速度继续
- 🔽 **降低**: 以降低的速度进行
- 🛡️ **保护**: 有最低保护机制

#### 核心系统离线行为表

| 系统/活动 | 时间类型 | 离线行为 | 具体说明 | 相关文档 |
|----------|---------|---------|---------|---------|
| **作物生长** | 活动时间 | ⏸️ 暂停 | 离线时不生长，保持当前进度 | [10-场景系统](./10-场景系统.md) |
| **钓鱼进度** | 活动时间 | ⏸️ 暂停 | 离线时中断，回归需重新开始 | [13-资源经济](./13-资源与经济系统.md) |
| **烹饪制作** | 活动时间 | ⏸️ 暂停 | 离线时暂停，回归后继续 | [13-资源经济](./13-资源与经济系统.md) |
| **天气变化** | 活动时间 | ⏸️ 暂停 | 保持离线时天气状态 | 本文档第3章 |
| **昼夜循环** | 活动时间 | ⏸️ 暂停 | 保持离线时的时段（视觉） | 本文档第2.2节 |
| **桌宠年龄** | 生命时间 | ▶️ 继续 | 按1:1现实时间增长 | [33-生命阶段](../30-扩展系统/33-生命阶段系统.md) |
| **工具学习** | 生命时间 | ▶️ 继续 | 理论部分最多累积30% | [18-工具学习](./18-工具学习与使用系统.md) |
| **关系冷却** | 生命时间 | ▶️ 继续 | 长时间不互动会冷却 | [32-关系系统](../30-扩展系统/32-关系系统.md) |
| **技能熟练度** | 生命时间 | ⏸️ 暂停 | 离线不衰减，保持当前值 | [17-成长技能](./17-成长与技能系统.md) |

#### 需求系统离线行为表

| 需求类型 | 时间类型 | 离线行为 | 在线衰减速度 | 离线衰减速度 | 最低保护值 | 相关文档 |
|---------|---------|---------|------------|------------|----------|---------|
| **饥饿度** | 混合 | 🔽 降低95% | -0.3点/现实分钟 | -0.015点/现实分钟 | 20点 | [11-需求系统](./11-桌宠AI与需求系统.md) |
| **疲劳度** | 混合 | 🔽 降低95% | -0.25点/现实分钟 | -0.0125点/现实分钟 | 20点 | [11-需求系统](./11-桌宠AI与需求系统.md) |
| **快乐度** | 混合 | ⏸️ 不衰减 | 动态变化 | 0 | 20点 | [11-需求系统](./11-桌宠AI与需求系统.md) |
| **健康度** | 混合 | ⏸️ 不衰减 | -0.05点/分钟(负面状态) | 0 | 20点 | [11-需求系统](./11-桌宠AI与需求系统.md) |
| **虔诚度** | 生命时间 | ▶️ 正常 | -0.002点/现实分钟 | -0.002点/现实分钟 | 0点 | [11-需求系统](./11-桌宠AI与需求系统.md) |

#### 经济系统离线行为表

| 系统 | 离线行为 | 具体说明 | 相关文档 |
|------|---------|---------|---------|
| **神力恢复** | ▶️ 继续 | 每小时5点，按生命时间计算 | [16-神力系统](./16-神力系统.md) |
| **金币生成** | ⏸️ 暂停 | 离线不产生被动收入 | [13-资源经济](./13-资源与经济系统.md) |
| **供奉积分** | ⏸️ 暂停 | 需要玩家在线操作 | [14-供奉系统](./14-供奉系统.md) |

#### 任务系统离线行为表

| 任务状态 | 离线行为 | 具体说明 | 相关文档 |
|---------|---------|---------|---------|
| **进行中任务** | ⏸️ 暂停 | 保持当前进度，不会超时 | [15-任务系统](./15-任务系统.md) |
| **任务倒计时** | ⏸️ 暂停 | 任务期限不会在离线时流逝 | [15-任务系统](./15-任务系统.md) |
| **每日任务** | ⏸️ 保留 | 离线时不刷新，回归后可完成昨日任务 | [15-任务系统](./15-任务系统.md) |

#### 离线时长影响汇总

| 离线时长 | 饥饿度下降 | 疲劳度下降 | 年龄增长 | 神力恢复 | 桌宠情绪 |
|---------|----------|----------|---------|---------|---------|
| **1小时** | -0.9点 | -0.75点 | +1小时 | +5点 | 想念 |
| **4小时** | -3.6点 | -3点 | +4小时 | +20点 | 有点寂寞 |
| **8小时** | -7.2点 | -6点 | +8小时 | +40点 | 很想你 |
| **12小时** | -10.8点 | -9点 | +12小时 | +60点 | 非常想念 |
| **24小时** | -21.6点 | -18点 | +1天 | +120点 | 触发重逢剧情 |

**离线保护机制说明**:
- 🛡️ **最低保护**: 所有需求最低保持20点，确保桌宠安全
- ⏰ **时间冻结**: 活动时间完全冻结，作物不会枯萎
- 💝 **情感补偿**: 离线越久，回归奖励越丰厚
- 📚 **学习持续**: 工具书理论部分可离线学习（最多30%）
- 🎁 **回归惊喜**: 12小时以上离线会触发特殊剧情

**设计理念**:
- ✅ 不惩罚玩家离线，营造安心感
- ✅ 保持生命的连续性（年龄、关系）
- ✅ 冻结即时活动（避免错过）
- ✅ 提供回归激励（补偿机制）

### 2.2 昼夜循环

**时段划分**:

| 时段 | 游戏时间 | 持续 | 光照 | 特点 |
|------|----------|------|------|------|
| 黎明 | 5:00-6:00 | 1小时 | 微光→亮 | 过渡时段 |
| 清晨 | 6:00-9:00 | 3小时 | 明亮 | 最佳工作时间 |
| 上午 | 9:00-12:00 | 3小时 | 明亮 | 高效率时段 |
| 中午 | 12:00-14:00 | 2小时 | 最亮 | 需要休息 |
| 下午 | 14:00-18:00 | 4小时 | 明亮 | 正常时段 |
| 傍晚 | 18:00-20:00 | 2小时 | 暗→微光 | 准备收工 |
| 夜晚 | 20:00-22:00 | 2小时 | 昏暗 | 休闲时间 |
| 深夜 | 22:00-5:00 | 7小时 | 黑暗 | 睡眠时间 |

**视觉效果**:

**清晨 (6:00-9:00)**:
- **天空**：呈现淡蓝色渐变，预示新的一天开始。
- **光照**：以温暖的金色为主，营造柔和的视觉效果。
- **阴影**：太阳角度较低，形成较长的阴影。
- **氛围**：整体感觉清新、充满活力。
- **特效**：可能出现朝露和晨雾，增加真实感。

**中午 (12:00-14:00)**:
- **天空**：呈现纯净的蓝色。
- **光照**：强烈而明亮的白光。
- **阴影**：太阳高悬，形成较短的阴影。
- **氛围**：炽热、明亮。
- **特效**：夏季可能出现热浪扭曲效果。

**傍晚 (18:00-20:00)**:
- **天空**：呈现橙红色渐变。
- **光照**：温暖的橙色光芒。
- **阴影**：太阳角度较低，形成较长的阴影。
- **氛围**：宁静、温馨。
- **特效**：可能出现晚霞和金光。

**夜晚 (20:00-5:00)**:
- **天空**：从深蓝色逐渐过渡到黑色。
- **光照**：主要来源于月光和星光。
- **阴影**：呈现朦胧的阴影效果。
- **氛围**：神秘、安静。
- **特效**：夏季可能出现星星闪烁和萤火虫。

### 2.3 时段影响

**对桌宠的影响**:

- **清晨 (6:00-9:00)**：
  - 工作效率：提升10%。
  - 心情：增加5点。
  - 疲劳恢复：若刚睡醒，恢复速度提升20%。
  - 行为倾向：优先进行工作类活动。

- **中午 (12:00-14:00)**：
  - 饥饿度下降：速度加快1.5倍（午餐时间）。
  - 工作效率：下降10%（需要休息）。
  - 行为倾向：进食、短暂休息。

- **下午 (14:00-18:00)**：
  - 正常状态：无额外加成或惩罚。

- **夜晚 (20:00-22:00)**：
  - 工作效率：下降20%。
  - 行为倾向：倾向于休闲活动，准备睡觉。

- **深夜 (22:00-5:00)**：
  - 工作效率：大幅下降50%。
  - 疲劳度下降：速度加快2倍（不睡觉的惩罚）。
  - 健康度下降：每小时下降5点（熬夜）。
  - 行为倾向：强制进入睡眠状态。

**对游戏玩法的影响**:

- **清晨**：
  - 作物露水：浇水效果提升20%。
  - 鱼类活跃：钓鱼效率提升15%。
  - 视野清晰：探索效率提升10%。

- **中午**：
  - 炎热：户外活动体力消耗增加10%。
  - 阴凉需求：在树荫下休息可更快恢复体力。

- **傍晚**：
  - 落日美景：观赏可获得10点心情加成。
  - 归巢：小动物NPC会返回巢穴。

- **夜晚**：
  - 夜行动物：特殊NPC可能出现。
  - 星空：玩家可以观星、许愿。
  - 萤火虫：夏季夜晚的特殊景观。

---

## 三、天气系统

### 3.1 基础天气类型

#### 天气1: 晴天 ☀️

**出现概率**: 40%

**视觉效果**:
- 天空: 蔚蓝色
- 云朵: 少量白云飘动
- 光照: 明亮温暖
- 特效: 阳光光束(上午)

**游戏影响**:

- 作物生长速度: 正常速度
- 作物需水量: 正常水平
- 心情加成: 每天增加5点
- 钓鱼效率: 正常效率
- 户外活动: 无限制
- 视野: 100%清晰度

**适合活动**: 所有户外活动

---

#### 天气2: 雨天 🌧️

**出现概率**: 30%

**视觉效果**:
- 天空: 灰色、阴沉
- 雨滴: 下落动画、水花
- 地面: 水坑形成
- 音效: 雨声、雷声(远处)

**游戏影响**:

- 作物生长速度: 提升10%
- 作物需水量: 自动满足(无需浇水)
- 心情: 每天轻微下降5点
- 钓鱼效率: 提升20%
- 户外活动: 桌宠会撑伞或穿雨衣
- 视野: 降低20%

**特殊机制**:
- 雨天持续4-8游戏小时
- 雨后可能出现彩虹
- 池塘水质自动改善

**桌宠行为**:
- 如果在户外,会撑伞
- 倾向于在家或有遮蔽的地方活动
- 雨衣动画(可解锁)

---

#### 天气3: 阴天 ☁️

**出现概率**: 20%

**视觉效果**:
- 天空: 浅灰色
- 云层: 厚重但不下雨
- 光照: 柔和散射光
- 氛围: 平静

**游戏影响**:

- 作物生长速度: 正常速度
- 心情: 无影响
- 钓鱼效率: 正常效率
- 视野: 100%清晰度

**特点**: 中性天气,常作为天气转换的过渡

---

#### 天气4: 暴雨 ⛈️

**出现概率**: 5%

**视觉效果**:
- 天空: 深灰色、乌云密布
- 雨滴: 倾盆大雨动画
- 闪电: 随机闪电特效
- 雷声: 惊雷音效
- 风: 树木摇晃

**游戏影响**:

- 作物生长速度: 提升15%
- 作物风险: 可能被淹或倒伏(5%概率)
- 心情: 每天下降15点
- 钓鱼: 无法进行
- 户外活动: 强烈不建议
- 视野: 降低50%

**特殊事件**:
- 桌宠被雷声吓到(动画)
- 可能损坏未加固的建筑
- 暴雨后池塘鱼类增多

---

#### 天气5: 大晴天 ☀️☀️

**出现概率**: 3%

**视觉效果**:
- 天空: 深蓝色、无云
- 光照: 强烈金光
- 特效: 光芒四射、热浪

**游戏影响**:

- 作物生长速度: 提升25%
- 作物需水量: 加倍(需要频繁浇水)
- 心情: 每天增加15点
- 钓鱼效率: 降低10%(鱼躲进深水)
- 体力消耗: 增加15%(炎热)

**适合活动**: 晒太阳、观景、供奉

---

#### 天气6: 雪天 ❄️ (冬季专属)

**出现概率**: 冬季40%

**视觉效果**:
- 天空: 灰白色
- 雪花: 飘落动画
- 地面: 积雪层
- 特效: 呼出的白气

**游戏影响**:

- 作物生长: 大部分停止(除非温室)
- 需求消耗: 饥饿度增加50%、疲劳度增加20%
- 心情: 每天下降10点(寒冷)
- 钓鱼: 需要破冰
- 户外活动: 移动速度降低30%
- 视野: 降低30%

**特殊机制**:
- 池塘结冰(需要破冰才能钓鱼)
- 可以堆雪人(趣味活动)
- 雪后美景(心情+20暂时)

---

### 3.2 特殊天气 (神力召唤)

#### 彩虹 🌈

**触发条件**: 雨后自然出现(10%概率) 或 玩家召唤(100神力点数)

**视觉效果**:
- 完整的彩虹横跨天空
- 七彩光芒
- 持续1-2游戏小时

**游戏影响**:

- 稀有鱼出现概率: 提升50%
- 心情: 增加20点
- 幸运值: 提升30%(所有随机事件好结果概率提升)
- 特殊: 可许愿(获得小奖励)

**许愿机制**:
- 桌宠在彩虹下双手合十
- 玩家可以选择赐予愿望
- 随机获得: 金币、稀有种子、特殊物品

---

#### 流星雨 🌠

**触发条件**: 特定日期(每月15日夜晚) 或 玩家召唤(150神力点数)

**视觉效果**:
- 夜空划过多颗流星
- 流星轨迹发光
- 持续1游戏小时

**游戏影响**:

- 许愿: 可以许愿3次
- 流星碎片: 地面掉落(可收集)
- 心情: 增加25点
- 浪漫氛围: 特殊事件触发率提升50%

**流星碎片**:
- 稀有材料
- 可用于特殊合成
- 供奉价值: 120神力点数

---

#### 极光 🌌

**触发条件**: 仅玩家召唤(200神力点数)

**视觉效果**:
- 绚丽的绿色/紫色极光
- 波动的光幕
- 持续6游戏小时

**游戏影响**:

- 所有属性: 提升10%
- 心情: 增加30点
- 工作效率: 提升20%
- 疲劳恢复: 提升30%
- 特殊: 所有行为都有光效加成

---

### 3.3 天气转换系统

**自然转换逻辑**:

**天气转换权重表**:

*晴天转换概率*:
- 保持晴天: 60%
- 转为阴天: 25%
- 转为雨天: 10%
- 转为大晴天: 5%

*阴天转换概率*:
- 转为晴天: 30%
- 保持阴天: 30%
- 转为雨天: 35%
- 转为暴雨: 5%

*雨天转换概率*:
- 保持雨天: 40%
- 转为阴天: 30%
- 转为晴天: 25%
- 出现彩虹: 5%(雨停后)

*暴雨转换概率*:
- 转为雨天: 60%
- 转为阴天: 35%
- 转为晴天: 5%

**天气持续时间**:

- 晴天: 4-12游戏小时
- 阴天: 2-6游戏小时
- 雨天: 3-8游戏小时
- 暴雨: 1-3游戏小时
- 大晴天: 6-10游戏小时
- 雪天: 4-12游戏小时

**玩家干预**:
- 使用神力可以立即改变天气
- 天气转换时播放过渡动画(30秒)
- 玩家无法直接召唤暴雨等负面天气(平衡考虑)

---

## 四、季节系统

### 4.1 四季划分

**季节时长**: 每季 = 30游戏天 = 12现实小时

### 4.2 春季 (Spring) 🌸

**时间**: 第1-30天

**气候特点**:
- 温度: 温和
- 降雨: 频繁 (雨天概率50%)
- 天气: 多变

**游戏影响**:

- 作物生长速度: 提升20%
- 种子发芽率: 提升15%
- 新作物解锁: 春笋、草莓
- 特殊事件: 春耕节(第1天)

**视觉风格**:
- 嫩绿色调
- 花朵盛开
- 小草生长
- 蝴蝶飞舞

**节日**:
- **春耕节** (第1天): 所有种子半价

---

### 4.3 夏季 (Summer) ☀️

**时间**: 第31-60天

**气候特点**:
- 温度: 炎热
- 降雨: 少 (雨天概率20%)
- 天气: 多晴天和大晴天

**游戏影响**:

- 作物需水量: 增加30%
- 体力消耗: 增加10%
- 新作物解锁: 西瓜、黄瓜、玉米
- 特殊事件: 仲夏祭(第15天)
- 夜晚特殊: 萤火虫出现

**视觉风格**:
- 明亮金黄
- 强烈阳光
- 蝉鸣音效
- 热浪扭曲

**节日**:
- **仲夏祭** (第15天): 所有奖励翻倍

---

### 4.4 秋季 (Autumn) 🍂

**时间**: 第61-90天

**气候特点**:
- 温度: 凉爽
- 降雨: 中等 (雨天概率30%)
- 天气: 多阴天和晴天

**游戏影响**:

- 作物产量: 提升20%
- 收获效率: 提升15%
- 新作物解锁: 南瓜、苹果
- 特殊事件: 丰收节(第15天)
- 氛围: 金色落叶

**视觉风格**:
- 金黄橙色
- 落叶飘零
- 成熟果实
- 温暖色调

**节日**:
- **丰收节** (第15天): 供奉转化率×2

---

### 4.5 冬季 (Winter) ❄️

**时间**: 第91-120天

**气候特点**:
- 温度: 寒冷
- 降雨: 雪天 (雪天概率40%)
- 天气: 多雪天和阴天

**游戏影响**:
- 大部分作物：无法种植（温室除外）。
- 需求消耗：增加1.5倍。
- 特殊鱼类：冬季鱼。
- 特殊事件：冬至（第15天）。
- 活动限制：户外活动受限。

**视觉风格**:
- 白色主调
- 积雪覆盖
- 冰霜特效
- 呼吸白雾

**节日**:
- **冬至** (第15天): 可制作特殊冬季食物

---

## 五、实现要点

### 5.1 数据结构

**时间系统**：
- **核心参数**：包括游戏分钟（0-59）、游戏小时（0-23，从早上6点开始）、游戏天（1-120）和游戏季节（春/夏/秋/冬）。
- **时间流速控制**：支持玩家调整时间流速（timeScale）和暂停游戏时间（isPaused）。
- **更新机制**：根据现实时间增量（realDeltaTime）更新游戏时间，并处理分钟、小时、天的进位，触发新一天和季节更新事件。
- **时段判断**：提供方法判断当前游戏时间所处的时段（黎明、清晨、上午、中午、下午、傍晚、夜晚、深夜）。

**天气系统**：
- **核心参数**：记录当前天气状态（currentWeather）、天气持续时间（weatherDuration）和计时器（weatherTimer）。
- **更新机制**：根据时间增量更新天气计时器，当达到持续时间时触发天气转换。
- **转换逻辑**：根据预设的天气转换权重表（weatherTransitions）和随机算法选择新的天气。
- **天气设置**：设置新的天气状态，并根据天气持续时间范围（weatherDurations）随机确定新的持续时间，重置计时器，并播放天气过渡动画。

---

## 六、测试验证

### 6.1 时间系统测试

**测试用例1: 时间流逝**
- 执行: 游戏运行24现实分钟
- 预期: 游戏内过去1天(24游戏小时)
- 验证: ✅ 时间正确流逝,无卡顿

**测试用例2: 昼夜效果**
- 执行: 观察全天的光照变化
- 预期: 光照平滑过渡,阴影正确变化
- 验证: ✅ 视觉效果自然

### 6.2 天气系统测试

**测试用例3: 天气转换**
- 执行: 观察10次天气转换
- 预期: 转换符合权重表,无异常天气
- 验证: ✅ 转换逻辑正确

**测试用例4: 天气影响**
- 执行: 雨天时检查作物需水量
- 预期: 土地自动湿润,无需浇水
- 验证: ✅ 天气影响生效

---

## 七、未来扩展

### 7.1 高级天气

- **龙卷风**: 极端天气事件
- **沙尘暴**: 特殊环境
- **浓雾**: 视野影响
- **冰雹**: 作物损害

### 7.2 天文系统

- **月相**: 满月、新月影响
- **日食/月食**: 特殊天文事件
- **行星排列**: 极稀有事件

### 7.3 气候变化

- **全球变暖**: 季节逐渐变化
- **极端天气频率**: 增加

---

## 八、总结

时间与天气系统为游戏提供了**自然的节奏和变化**,是构建游戏世界真实感的关键系统。

**核心设计**:
- ✅ 完整的昼夜循环和四季系统
- ✅ 丰富的天气类型和影响
- ✅ 玩家可以通过神力影响天气
- ✅ 时间和天气显著影响游戏玩法

**实现优先级**:
- P0 (MVP v1.0): 基础时间流逝、3-4种天气
- P1 (MVP v1.5): 完整昼夜效果、6种天气
- P2 (MVP v2.0): 季节系统、特殊天气
- P3 (MVP v3.0+): 高级天气、天文系统

---

**时间流转,四季更替,这是生命的节奏 ⏰🌦️**